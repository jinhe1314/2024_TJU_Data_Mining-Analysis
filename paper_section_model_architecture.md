# 模型架构与设计

## 1. 概述

为了准确预测糖尿病患者未来的血糖水平，本研究提出了一种基于深度学习的混合神经网络模型（Glucose Concentration Model, GCM）。该模型采用双流（Dual-Stream）架构，分别处理动态的时间序列数据（如连续血糖监测值、药物注射记录、饮食摄入）和静态的患者特征数据（如年龄、性别、BMI）。模型的核心创新在于引入了交叉注意力（Cross-Attention）机制，以有效融合这两类异构数据，捕捉它们之间复杂的非线性交互关系。

## 2. 网络架构细节

GCM 模型主要由三个模块组成：特征编码模块、特征融合模块和预测解码模块。

### 2.1 特征编码模块 (Feature Encoding Module)

该模块包含两个独立的编码器，分别用于提取时序特征和静态特征的高维表示。

#### 2.1.1 时序特征编码器 (Time-Series Encoder)
针对血糖数据的时序依赖性，我们采用长短期记忆网络（LSTM）作为核心组件。输入数据形状为 $(B, T, F_{ts})$，其中 $B$ 为批次大小，$T=10$ 为时间步长（代表过去150分钟的历史窗口），$F_{ts}=51$ 为时序特征数量。
编码器由 6 层堆叠的 LSTM 层组成，隐藏单元数逐层递减（64 $\to$ 56 $\to$ 48 $\to$ 40 $\to$ 36 $\to$ 32）。这种“漏斗形”设计旨在逐层压缩信息，提取最具代表性的时序特征，同时防止过拟合。最后一层 LSTM 输出的特征向量 $h_{ts} \in \mathbb{R}^{32}$ 包含了历史血糖波动和行为模式的全局上下文信息。

#### 2.1.2 静态特征编码器 (Static Feature Encoder)
针对患者的个体差异，我们设计了一个多层感知机（MLP）来处理静态特征。输入数据形状为 $(B, F_{static})$，其中 $F_{static}=30$。
该编码器包含 8 层全连接（Dense）层，激活函数均采用 ReLU。层宽设计同样采用递减策略（64 $\to$ ... $\to$ 32），并在最后三层保持 32 维输出。最终得到的静态特征嵌入 $h_{static} \in \mathbb{R}^{32}$ 编码了患者的生理机能和代谢特征。

### 2.2 特征融合模块 (Feature Fusion Module)

为了深入挖掘时序动态与静态特征之间的关联（例如，相同的胰岛素剂量在不同胰岛素敏感性的患者身上产生的效果不同），本研究引入了双向交叉注意力机制。

该模块包含两个并行的注意力计算路径：
1.  **Static-Query Attention**: 以静态特征 $h_{static}$ 为查询（Query），时序特征 $h_{ts}$ 为键（Key）和值（Value）。旨在根据患者的体质特征，动态关注时序数据中的特定模式。
2.  **Time-Query Attention**: 以时序特征 $h_{ts}$ 为查询，静态特征 $h_{static}$ 为键和值。旨在根据当前的血糖波动状态，重新加权静态特征的重要性。

计算公式如下：
$$
\text{Attention}(Q, K, V) = \text{softmax}(\frac{QK^T}{\sqrt{d_k}})V
$$
两个方向的注意力输出经过拼接（Concatenate），形成最终的融合特征向量 $h_{fusion} \in \mathbb{R}^{64}$。

### 2.3 预测解码模块 (Prediction Decoding Module)

解码器负责将融合后的特征映射到未来的血糖值。该模块由 7 层全连接层组成（64 $\to$ 56 $\to$ 48 $\to$ 40 $\to$ 36 $\to$ 32 $\to$ 16），层间使用 ReLU 激活函数以增加非线性表达能力。
输出层包含 4 个神经元，分别对应未来 15、30、45 和 60 分钟的血糖预测值。

## 3. 损失函数与优化

模型训练采用均方误差（MSE）作为损失函数，以最小化预测值与真实血糖值之间的差异：
$$
L = \frac{1}{N} \sum_{i=1}^{N} ||y_i - \hat{y}_i||^2
$$
其中 $y_i$ 为真实值，$\hat{y}_i$ 为预测值。优化器选用 Adam，并结合了学习率衰减（ReduceLROnPlateau）和早停（EarlyStopping）策略，以确保模型收敛至最优解并具备良好的泛化能力。
